# PirateIsles — .todo
# Смысл игры, что реализовано, что планируется менять и дополнять

---

## Суть игры

**PirateIsles** — браузерная idle PvPvE стратегия в пиратском сеттинге: топ-даун моря, острова, корабли.

- Игрок развивает свой остров (таверна, dok, пушки), собирает ресурсы (ром, золото, дерево), строит лодки, отправляет их в PvE-рейды и на ресурсные острова, может атаковать других игроков (PvP). Есть оффлайн-прогресс, щит после атаки, стадии разрушения острова и legacy-бонус.
- В перспективе — ручное управление кораблём (WASD) в отдельном приложении (Captain Mode).

Цель MVP: играбельный остров, idle-рейды, оффлайн-прогресс, базовый PvP с защитой. Это достигнуто.

---

## Что уже реализовано

- Логин (ник + опциональный пароль), guest-режим.
- Остров игрока: уровни, постройки (таверна, dok, пушки, остров), визуал (эллипс, placeholder-здания), щит-купол, стадии разрушения (нормальный / повреждённый / разрушенный).
- Ресурсы: ром (пассивный доход от таверны), золото, дерево; отображение в HUD и в панели построек.
- Рейды: AI-рейд (кнопка, таймер, анимация лодки в 3 фазы, возврат только при успехе); рейды на архипелаг (островки у базы, клик → отправка лодки, деплеция, лут); рейды на ресурсные острова на мировой карте (клик по острову, таймер, лут, деплеция, персистентность в Redis).
- PvP: список игроков, атака (летящая миссия), кража ресурсов, щит 4–8 ч, debris (сбор золота), legacy-бонус.
- Мировая карта: переключение вид база/мир, камера, миникарта, ресурсные острова, PvP-миссии; кнопка «Вернуться на базу».
- Оффлайн-прогресс: при логине модалка с временем отсутствия и полученным ромом (и деревом от архипелага).
- Вода: переливающийся градиент + тайл ряби (ripples.png) с параллаксом.
- Ассеты: папка `assets/` (sea, ui, sprites, fonts, audio); структура по `assets/README.md`; используются ripples.png, island1.png и др.
- Docker: образ с копированием `assets/`, volume для `./assets` в docker-compose.
- UI: тосты (успех/ошибка/info), панель рейдов с группировкой и сортировкой по ETA, звуки (волны, монета, отправка лодки), i18n RU/EN.
- Апгрейд дока даёт полный набор лодок до нового лимита.
- **Лодки:** dok задаёт лимит; лодки строятся отдельно за дерево (`buyBoat`, 80 дерева); потеря лодки в рейде не перманентна — можно построить замену.
- **Анимация PvE-рейда:** лодка отплывает от края острова в случайном направлении, исчезает через 5 сек, появляется и возвращается только при успехе (за 5 сек до зачисления); при потере — не возвращается визуально.

---

## Что планируется в дальнейшем

### Доработки и улучшения
- Заменить placeholder-графику на спрайты из `assets/` (острова, постройки, корабли, эффекты) по README.
- При желании — рефакторинг фронта: вынос JS/CSS в отдельные файлы (main.js, render.js и т.д.) после стабилизации MVP.
- Расширить чат (сейчас простой глобальный лог) до полноценной системы при необходимости.
- Улучшать баланс и подбирать параметры (время рейдов, луты, проценты кражи, оффлайн, стоимость лодки) — всё правится на сервере.
- Добавить анимацию лодки для рейдов на архипелаг (сейчас только прогресс-бар без визуала лодки).

### Новый контент и механики (по приоритету / по желанию)
- **Имперские караваны (§7.3):** движущиеся NPC на мировой карте, маршрут петлёй, отправка лодки на перехват, повышенный лут и риск потери лодки; сервер тикает позицию, рассылает в state (например caravans[] или pvpMissions).
- **Враждебные NPC (§7.4):** пираты/монстры на карте, движение, атака островов при слабой обороне, лут при победе.
- **Острова с сокровищами (§7.5):** редкие точки с большим лутом, respawn раз в несколько часов, конкуренция между игроками.
- **Кланы:** объединение игроков, общие цели или бонусы (идеи уточнять).
- **События, косметика, аудио (BGM), push-уведомления** — по необходимости.

### Captain Mode (отдельное приложение)
- Решение: отдельный standalone (например captain.html или отдельный репозиторий), общий бэкенд и Redis.
- Управление кораблём в реальном времени (WASD), синхронизация ресурсов и прогресса с основной idle-игрой.
- Начинать после стабилизации idle-core.

### Возможные изменения и упрощения
- Убрать или упростить редко используемые механики, если перегружают баланс или UI.
- Переименовать/унифицировать термины (например gold vs дублоны) в UI и текстах.
- Документировать контракты socket.io и Redis при добавлении новых событий или ключей.

---

## Технические заметки (для планов)

- **Redis:** при добавлении новых ключей или форматов (игроки, острова, караваны и т.д.) обновлять описание схемы (сейчас кратко в .agent, детали можно перенести сюда или в отдельный doc).
- **Баланс:** все числа и формулы — на сервере; клиент только отображает. При изменении формул оффлайна, кражи, debris, стоимости лодки и т.д. обновлять константы в server.js и при необходимости .todo/.agent.
- **Ассеты:** именование и структура — по `assets/README.md`; при добавлении новых файлов соблюдать snake_case и описанную структуру папок.
- **Константы лодок:** `BOAT_BUILD_COST` в server.js и в index.html (секция balance constants) должны совпадать — менять синхронно.

---

*Файл .todo обновлять по мере реализации пунктов и появления новых планов.*
